(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[198],{1355:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/simple-auth",function(){return r(3178)}])},3178:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var o=r(5893),a=r(7294),n=r(1163),i=r(4319);function l(){let[e,t]=(0,a.useState)(!0),[r,l]=(0,a.useState)({name:"",email:"",password:""}),[s,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(""),[g,p]=(0,a.useState)(!1),m=(0,n.useRouter)();(0,a.useEffect)(()=>{let e=new URLSearchParams(window.location.search),t=e.get("auth"),r=e.get("token"),o=e.get("user");if("telegram"===t&&r&&o)try{console.log("\uD83D\uDD10 Начинаем Telegram авторизацию..."),console.log("\uD83D\uDD10 Параметры:",{auth:t,token:r,user:o});let e=JSON.parse(decodeURIComponent(o));console.log("\uD83D\uDD10 Telegram авторизация:",e),localStorage.setItem("user",JSON.stringify({id:e.id,name:e.first_name||e.username||"User".concat(e.id),email:"".concat(e.username||e.id,"@telegram.local"),photo:e.photo_url||"",source:"telegram"})),u("✅ Авторизация через Telegram успешна!"),setTimeout(()=>{m.push("/simple-rooms")},1e3)}catch(e){console.error("❌ Ошибка парсинга Telegram данных:",e),u("❌ Ошибка авторизации через Telegram")}},[m]);let h=async t=>{t.preventDefault(),d(!0),u("");try{e?(localStorage.setItem("user",JSON.stringify({email:r.email,name:r.email.split("@")[0]})),u("Авторизация успешна!")):(localStorage.setItem("user",JSON.stringify({name:r.name,email:r.email})),u("Регистрация успешна!")),setTimeout(()=>{m.push("/rooms")},1500)}catch(e){u("Ошибка: "+e.message)}finally{d(!1)}},x=async()=>{try{p(!0),u("");let e=await fetch("".concat("http://localhost:4000","/tg/new-token")),t=await e.json();if(!t.ok)throw Error(t.error||"Failed to get token");let r=t.token;console.log("\uD83D\uDD11 Получен токен:",r);let o=document.createElement("script");o.src="https://telegram.org/js/telegram-widget.js?22",o.setAttribute("data-telegram-login","energy_m_bot"),o.setAttribute("data-size","large"),o.setAttribute("data-onauth","onTelegramAuth(user, ".concat(JSON.stringify({token:r}),")")),o.setAttribute("data-request-access","write"),document.body.appendChild(o),window.onTelegramAuth=async(e,t)=>{try{console.log("\uD83D\uDD10 Telegram авторизация:",e);let r=await fetch("".concat("http://localhost:4000","/tg/authorize"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t.token,id:e.id,username:e.username,first_name:e.first_name,last_name:e.last_name,photo_url:e.photo_url})}),o=await r.json();if(o.ok&&o.authorized){let e={id:o.user.id,name:o.user.firstName||o.user.username||"Telegram User",email:"".concat(o.user.username||o.user.id,"@telegram.local")};localStorage.setItem("user",JSON.stringify(e)),u("✅ Авторизация через Telegram успешна!"),setTimeout(()=>{m.push("/simple-rooms")},1e3)}else throw Error(o.error||"Authorization failed")}catch(e){console.error("❌ Ошибка Telegram авторизации:",e),u("❌ Ошибка авторизации через Telegram")}finally{p(!1)}}}catch(e){console.error("❌ Ошибка получения токена:",e),u("❌ Ошибка подключения к серверу"),p(!1)}};return(0,o.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"Arial, sans-serif"},children:[(0,o.jsxs)("div",{style:{background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(15px)",borderRadius:"20px",padding:"40px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",border:"2px solid rgba(255, 255, 255, 0.3)",width:"100%",maxWidth:"400px"},children:[(0,o.jsx)("h1",{style:{color:"white",textAlign:"center",marginBottom:"30px",fontSize:"2rem",fontWeight:"bold"},children:"Energy of Money"}),(0,o.jsxs)("div",{style:{display:"flex",marginBottom:"30px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"10px",padding:"5px"},children:[(0,o.jsx)("button",{onClick:()=>t(!0),style:{flex:1,padding:"10px",border:"none",borderRadius:"8px",background:e?"rgba(255, 255, 255, 0.2)":"transparent",color:"white",cursor:"pointer",transition:"all 0.3s ease"},children:"Вход"}),(0,o.jsx)("button",{onClick:()=>t(!1),style:{flex:1,padding:"10px",border:"none",borderRadius:"8px",background:e?"transparent":"rgba(255, 255, 255, 0.2)",color:"white",cursor:"pointer",transition:"all 0.3s ease"},children:"Регистрация"})]}),(0,o.jsxs)("form",{onSubmit:h,children:[!e&&(0,o.jsx)("div",{style:{marginBottom:"20px"},children:(0,o.jsx)("input",{type:"text",placeholder:"Имя",value:r.name,onChange:e=>l({...r,name:e.target.value}),required:!e,style:{width:"100%",padding:"15px",border:"none",borderRadius:"10px",background:"rgba(255, 255, 255, 0.1)",color:"white",fontSize:"16px",boxSizing:"border-box"}})}),(0,o.jsx)("div",{style:{marginBottom:"20px"},children:(0,o.jsx)("input",{type:"email",placeholder:"Email",value:r.email,onChange:e=>l({...r,email:e.target.value}),required:!0,style:{width:"100%",padding:"15px",border:"none",borderRadius:"10px",background:"rgba(255, 255, 255, 0.1)",color:"white",fontSize:"16px",boxSizing:"border-box"}})}),(0,o.jsx)("div",{style:{marginBottom:"30px"},children:(0,o.jsx)("input",{type:"password",placeholder:"Пароль",value:r.password,onChange:e=>l({...r,password:e.target.value}),required:!0,style:{width:"100%",padding:"15px",border:"none",borderRadius:"10px",background:"rgba(255, 255, 255, 0.1)",color:"white",fontSize:"16px",boxSizing:"border-box"}})}),(0,o.jsx)("button",{type:"submit",disabled:s,style:{width:"100%",padding:"15px",border:"none",borderRadius:"10px",background:"linear-gradient(45deg, #667eea, #764ba2)",color:"white",fontSize:"16px",fontWeight:"bold",cursor:s?"not-allowed":"pointer",opacity:s?.7:1,transition:"all 0.3s ease"},children:s?"Загрузка...":e?"Войти":"Зарегистрироваться"}),(0,o.jsx)("div",{style:{margin:"20px 0",textAlign:"center",color:"rgba(255, 255, 255, 0.7)",fontSize:"14px"},children:"или"}),(0,o.jsx)("button",{onClick:x,disabled:g,style:{width:"100%",padding:"15px",border:"none",borderRadius:"10px",background:"linear-gradient(45deg, #0088cc, #00a8ff)",color:"white",fontSize:"16px",fontWeight:"bold",cursor:g?"not-allowed":"pointer",opacity:g?.7:1,transition:"all 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:g?"\uD83D\uDD04 Загрузка...":"\uD83D\uDCF1 Войти через Telegram"})]}),c&&(0,o.jsx)("div",{style:{marginTop:"20px",padding:"10px",borderRadius:"8px",background:"rgba(255, 255, 255, 0.1)",color:"white",textAlign:"center"},children:c}),(0,o.jsx)("div",{style:{marginTop:"30px",textAlign:"center",color:"rgba(255, 255, 255, 0.7)",fontSize:"14px"},children:(0,o.jsxs)("p",{children:["Telegram Bot: ",(0,o.jsx)("a",{href:"https://t.me/energy_m_bot",style:{color:"white"},children:"@energy_m_bot"})]})})]}),(0,o.jsx)(i.Z,{})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=1355)}),_N_E=e.O()}]);