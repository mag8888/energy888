<!DOCTYPE html>
<html>
<head>
    <title>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è Safari - Energy of Money</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 50px auto; 
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
        }
        .container {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
        }
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            opacity: 0.8;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
        }
        .safari-specific {
            background: rgba(255, 165, 0, 0.2);
            border: 1px solid #ffa500;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçé –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è Safari</h1>
        <p>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ Safari</p>
        
        <div class="safari-specific">
            <h3>‚ö†Ô∏è Safari —Ç—Ä–µ–±—É–µ—Ç –æ—Å–æ–±–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞</h3>
            <p>Safari –∫—ç—à–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ-–¥—Ä—É–≥–æ–º—É, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</p>
        </div>
        
        <div class="status" id="status">
            <div>–¢–µ–∫—É—â–∏–π Socket URL: <span id="currentUrl">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
            <div>–°—Ç–∞—Ç—É—Å: <span id="connectionStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span></div>
            <div>–ë—Ä–∞—É–∑–µ—Ä: <span id="browserInfo">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...</span></div>
        </div>
        
        <button onclick="safariFix()">üçé –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥–ª—è Safari</button>
        <button onclick="clearAllCaches()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∫—ç—à–∏</button>
        <button onclick="testConnection()">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
        <button onclick="goToGame()">üéÆ –ü–µ—Ä–µ–π—Ç–∏ –∫ –∏–≥—Ä–µ</button>
        
        <div id="logs" style="margin-top: 20px; text-align: left; font-size: 14px;"></div>
    </div>

    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <script>
        function log(message) {
            console.log(message);
            const logs = document.getElementById('logs');
            logs.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
        }
        
        function detectBrowser() {
            const userAgent = navigator.userAgent;
            if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {
                return 'Safari';
            } else if (userAgent.includes('Chrome')) {
                return 'Chrome';
            } else if (userAgent.includes('Firefox')) {
                return 'Firefox';
            } else {
                return 'Unknown';
            }
        }
        
        function updateStatus() {
            const currentUrl = localStorage.getItem('SOCKET_URL') || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
            document.getElementById('currentUrl').textContent = currentUrl;
            document.getElementById('browserInfo').textContent = detectBrowser();
            
            if (currentUrl.includes('localhost')) {
                document.getElementById('connectionStatus').textContent = '‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL (localhost)';
                document.getElementById('connectionStatus').style.color = '#ff6b6b';
            } else if (currentUrl.includes('energy888-advanced-socket.onrender.com')) {
                document.getElementById('connectionStatus').textContent = '‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π URL';
                document.getElementById('connectionStatus').style.color = '#4CAF50';
            } else {
                document.getElementById('connectionStatus').textContent = '‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π URL';
                document.getElementById('connectionStatus').style.color = '#ffa500';
            }
        }
        
        function safariFix() {
            log('üçé –ù–∞—á–∏–Ω–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è Safari...');
            
            // –û—á–∏—â–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫—ç—à–∏
            try {
                // –û—á–∏—â–∞–µ–º localStorage
                localStorage.clear();
                log('‚úÖ –û—á–∏—â–µ–Ω localStorage');
                
                // –û—á–∏—â–∞–µ–º sessionStorage
                sessionStorage.clear();
                log('‚úÖ –û—á–∏—â–µ–Ω sessionStorage');
                
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ cookies
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
                log('‚úÖ –û—á–∏—â–µ–Ω—ã cookies');
                
            } catch (e) {
                log('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ: ' + e.message);
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL
            localStorage.setItem('SOCKET_URL', 'https://money8888-production.up.railway.app');
            log('‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Socket URL: ' + localStorage.getItem('SOCKET_URL'));
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è Safari - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º
            if (detectBrowser() === 'Safari') {
                log('üçé –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Safari...');
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                localStorage.setItem('FORCE_RELOAD', 'true');
                localStorage.setItem('BROWSER', 'safari');
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                const url = new URL(window.location);
                url.searchParams.set('t', Date.now().toString());
                url.searchParams.set('safari', 'true');
                
                log('üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥–ª—è Safari...');
                setTimeout(() => {
                    window.location.href = url.toString();
                }, 2000);
            } else {
                updateStatus();
                setTimeout(() => {
                    log('üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É...');
                    window.location.reload();
                }, 2000);
            }
        }
        
        function clearAllCaches() {
            log('üóëÔ∏è –û—á–∏—â–∞–µ–º –≤—Å–µ –∫—ç—à–∏...');
            
            // –û—á–∏—â–∞–µ–º –≤—Å–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
            try {
                localStorage.clear();
                sessionStorage.clear();
                indexedDB.deleteDatabase('localforage');
                log('‚úÖ –í—Å–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –æ—á–∏—â–µ–Ω—ã');
            } catch (e) {
                log('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Ö—Ä–∞–Ω–∏–ª–∏—â: ' + e.message);
            }
            
            // –û—á–∏—â–∞–µ–º cookies
            document.cookie.split(";").forEach(function(c) { 
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
            });
            log('‚úÖ Cookies –æ—á–∏—â–µ–Ω—ã');
            
            updateStatus();
        }
        
        function testConnection() {
            log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');
            
            const server = 'https://money8888-production.up.railway.app';
            const socket = io(server, {
                transports: ['websocket', 'polling'],
                timeout: 10000,
                forceNew: true // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
            });
            
            socket.on('connect', () => {
                log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! ID: ' + socket.id);
                socket.disconnect();
            });
            
            socket.on('connect_error', (error) => {
                log('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message);
            });
            
            socket.on('disconnect', () => {
                log('üîå –û—Ç–∫–ª—é—á–∏–ª–∏—Å—å –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
            });
        }
        
        function goToGame() {
            // –î–ª—è Safari –¥–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            const gameUrl = 'https://money8888-production.up.railway.app/simple-rooms/';
            const url = new URL(gameUrl);
            url.searchParams.set('t', Date.now().toString());
            url.searchParams.set('safari', 'true');
            url.searchParams.set('socket', 'https://money8888-production.up.railway.app');
            
            window.open(url.toString(), '_blank');
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        updateStatus();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        if (detectBrowser() === 'Safari' && localStorage.getItem('SOCKET_URL') && localStorage.getItem('SOCKET_URL').includes('localhost')) {
            log('üçé –û–±–Ω–∞—Ä—É–∂–µ–Ω Safari —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º URL, –ø—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ...');
            setTimeout(safariFix, 1000);
        }
    </script>
</body>
</html>

